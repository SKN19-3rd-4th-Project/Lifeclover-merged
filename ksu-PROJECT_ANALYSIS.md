# Lifeclover í”„ë¡œì íŠ¸ ì¢…í•© ë¶„ì„ ë¬¸ì„œ

## ðŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**Lifeclover**ëŠ” RAG(Retrieval-Augmented Generation) + LLM ê¸°ë°˜ì˜ ì±—ë´‡ê³¼ ë‹¤ì´ì–´ë¦¬ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìž…ë‹ˆë‹¤.

Well Dying ì •ì‹ ì„ ë°”íƒ•ìœ¼ë¡œ Well Lifeë¥¼ ì„ ì‚¬í•˜ëŠ” ì„œë¹„ìŠ¤ ìž…ë‹ˆë‹¤.

---

## ðŸ”„ ìµœê·¼ ì—…ë°ì´íŠ¸ (2025.12.12)

### 1. ì±—ë´‡ ì§€ëŠ¥ ê³ ë„í™” (Empathy Agent)
- **Context Analyzer (í†µí•© ë¶„ì„ê¸°) ë„ìž…**:
    - ê¸°ì¡´ì˜ ë‹¨ìˆœ 'ì§„ì§€í•¨ ì ìˆ˜' ë¶„ì„ì„ ë„˜ì–´, **'ê³ í†µ ë ˆë²¨(Pain Level)'**ê³¼ **'ì§„ì§€í•¨ ì ìˆ˜(Seriousness Score)'**ë¥¼ ë™ì‹œì— ë¶„ì„.
    - **ê³„ì¸µì  íŒë‹¨ ë¡œì§(Hierarchy)** ì ìš©: ê³ í†µ ë ˆë²¨ì´ ë†’ìœ¼ë©´(7+) ì§„ì§€í•¨ ì ìˆ˜ë¥¼ ë¬´ì‹œí•˜ê³  ì¦‰ì‹œ **[ê¸´ê¸‰ ì¼€ì–´ ëª¨ë“œ]**ë¡œ ì§„ìž….
- **ì˜ë£Œì  íŒ©íŠ¸ ì²´í¬ (Medical Grounding)**:
    - í™˜ìžì˜ ë¶€ì •í™•í•œ ì˜í•™ ìš©ì–´(ì˜ˆ: "ì‹œìŠ¤í”Œë¼í‹´ ë¨¹ëŠ”ë‹¤")ë¥¼ ì•µë¬´ìƒˆì²˜ëŸ¼ ë”°ë¼ í•˜ì§€ ì•Šê³ , "ì¹˜ë£Œë°›ëŠ”ë‹¤" ë“±ìœ¼ë¡œ êµì •í•˜ì—¬ ë‹µë³€.
- **ë¬´í•œ ë£¨í”„ ë°©ì§€ (Anti-Looping)**:
    - "ì˜ì‚¬ê°€ ì•ˆ ëœëŒ€"ë¼ëŠ” ì ˆë§ì  í‘œí˜„ì— ëŒ€í•´ ê¸°ê³„ì ì¸ "ë³‘ì› ê°€ì„¸ìš”" ë‹µë³€ì„ ì°¨ë‹¨í•˜ê³  ì •ì„œì  ì§€ì§€ë¡œ ì „í™˜.

### 2. í™œë™ ì¶”ì²œ ë¡œì§ ê°œì„  (Recommend Activity Tool)
- **Pain-Aware Logic (ê³ í†µ ê°ì§€ ë¡œì§)**:
    - ì‚¬ìš©ìžê°€ ê·¹ì‹¬í•œ ê³ í†µ("ë¯¸ì¹˜ê² ë‹¤", "ë„ˆë¬´ ì•„íŒŒ")ì„ í˜¸ì†Œí•˜ê±°ë‚˜ ê±°ë™ ë¶ˆê°€ ìƒíƒœì¼ ê²½ìš° ê°ì§€.
    - ë…ì„œ/TV ë“± ëŠ¥ë™ì  í™œë™ ì¶”ì²œì„ ì°¨ë‹¨í•˜ê³ , **'5-4-3-2-1 ê¸°ë²•', 'ìƒìƒ ì—¬í–‰', 'í˜¸í¡ë²•'** ë“± **Micro-Activities**ë¥¼ ì¦‰ì‹œ ì²˜ë°©.

### 3. ì¸í”„ë¼ ë° íŽ¸ì˜ì„± ê°œì„ 
- **Ngrok ì›í´ë¦­ ì‹¤í–‰**: `Lifeclover_Server_Start.bat` ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ (ì„œë²„+Ngrok ë™ì‹œ ì‹¤í–‰).
- **í™˜ê²½ ì„¤ì • ì•ˆì •í™”**: `.env` ê²½ë¡œ ì¸ì‹ ë¬¸ì œ í•´ê²° ë° Pinecone ì—°ê²° ìŠ¤í¬ë¦½íŠ¸(`debug_pinecone.py`) ê°œì„ .

---

## ðŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Lifeclover-ui/
â”œâ”€â”€ chatbot/                    # ì±—ë´‡ í•µì‹¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ conversation_engine.py  # LangGraph ê¸°ë°˜ ëŒ€í™” ì—”ì§„
â”‚   â”œâ”€â”€ chatbot_modules/
â”‚   â”‚   â”œâ”€â”€ llm_client.py       # OpenAI LLM í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ empathy_agent.py     # ê°ì„± ëŒ€í™” ì—ì´ì „íŠ¸ (Context Analyzer í¬í•¨)
â”‚   â”‚   â”œâ”€â”€ info_agent.py       # ì •ë³´ ì œê³µ ì—ì´ì „íŠ¸ (ì •ë³´ ëª¨ë“œ)
â”‚   â”‚   â”œâ”€â”€ session_manager.py  # ì‚¬ìš©ìž ì„¸ì…˜ ë° ëŒ€í™” ê¸°ë¡ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ diary_manager.py    # ë‹¤ì´ì–´ë¦¬ ìƒì„± ë° ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ recommend_ba.py    # RAG ë„êµ¬ (Pinecone, Tavily, Pain-Aware Logic)
â”‚   â””â”€â”€ sessions/               # ì„¸ì…˜ ë° ë‹¤ì´ì–´ë¦¬ ì €ìž¥ì†Œ
â”‚
â”œâ”€â”€ config/                     # Django ì„¤ì •
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ web/                        # Django ì•±
â”‚   â””â”€â”€ views.py                # API ì—”ë“œí¬ì¸íŠ¸
â”‚
â”œâ”€â”€ templates/                  # HTML í…œí”Œë¦¿
â”‚   â”œâ”€â”€ base.html
â”‚   â””â”€â”€ index.html
â”‚
â”œâ”€â”€ static/                     # ì •ì  íŒŒì¼
â”‚   â”œâ”€â”€ css/style.css
â”‚   â”œâ”€â”€ js/app.js
â”‚   â””â”€â”€ img/
â”‚
â”œâ”€â”€ data/                       # ë°ì´í„° íŒŒì¼
â”‚   â”œâ”€â”€ conversation_rules.json
â”‚   â”œâ”€â”€ empathy_questions.csv
â”‚   â”œâ”€â”€ facilities_region_list.json
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ Lifeclover_Server_Start.bat # ì„œë²„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (Local Only)
â””â”€â”€ requirements.txt            # Python ì˜ì¡´ì„±
```

---

## ðŸ”§ ì‚¬ìš©ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ê¸°ìˆ  ìŠ¤íƒ

### Backend (Python/Django)
- **Django** (>=5.0, <6.0): ì›¹ í”„ë ˆìž„ì›Œí¬
- **LangChain**: LLM í†µí•© ë° ì²´ì¸ êµ¬ì„±
- **LangGraph**: ëŒ€í™” íë¦„ ê´€ë¦¬ (StateGraph)
- **OpenAI** (GPT-4o): LLM ëª¨ë¸
- **Pinecone**: ë²¡í„° DB (RAG ê²€ìƒ‰)
- **Tavily**: ì‹¤ì‹œê°„ ì›¹ ê²€ìƒ‰
- **python-dotenv**: í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

### Frontend
- **Vanilla JavaScript**: ìˆœìˆ˜ JS (í”„ë ˆìž„ì›Œí¬ ì—†ìŒ)
- **Django Templates**: ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§
- **CSS**: ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ì‹œíŠ¸

### ë°ì´í„°ë² ì´ìŠ¤
- **MySQL**: ë©”ì¸ DB (`lcdb`)
- **SQLite**: ê°œë°œìš© ë³´ì¡° (ë˜ëŠ” ì´ˆê¸° ì„¤ì •)

---

## ðŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ì„¤ì •

```bash
# ì½˜ë‹¤ ê°€ìƒí™˜ê²½ í™œì„±í™”
conda activate ml_env

# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd Lifeclover-ui

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ ìƒì„±:

```env
OPENAI_API_KEY=your_openai_api_key
PINECONE_API_KEY=your_pinecone_api_key
TAVILY_API_KEY=your_tavily_api_key
```

### 3. ì„œë²„ ì‹¤í–‰ (ë‘ ê°€ì§€ ë°©ë²•)

**ë°©ë²• A: ì›í´ë¦­ ì‹¤í–‰ (Windows)**
- `Lifeclover_Server_Start.bat` íŒŒì¼ì„ ì‹¤í–‰í•˜ë©´ Django ì„œë²„ì™€ Ngrokì´ ë™ì‹œì— ì¼œì§‘ë‹ˆë‹¤.

**ë°©ë²• B: ìˆ˜ë™ ì‹¤í–‰**
```bash
# í„°ë¯¸ë„ 1: Django ì„œë²„
python manage.py runserver

# í„°ë¯¸ë„ 2: Ngrok (ì™¸ë¶€ ì ‘ì†ìš©)
npx ngrok http 8000
```

ê¸°ë³¸ ì£¼ì†Œ: `http://127.0.0.1:8000/`

---

## ðŸŽ¯ ì£¼ìš” ê¸°ëŠ¥ ì„¤ëª…

### 1. ì±—ë´‡ ì‹œìŠ¤í…œ (LangGraph ê¸°ë°˜)

#### ë‘ ê°€ì§€ ëª¨ë“œ

**A. ê°ì„± ëŒ€í™” ëª¨ë“œ (`empathy_agent`)**
- **Context Analyzer**: ê³ í†µ(Pain)ê³¼ ì§„ì§€í•¨(Seriousness)ì„ ì‹¤ì‹œê°„ ë¶„ì„
- **Pain-Aware Response**: ê³ í†µ ë ˆë²¨ 7 ì´ìƒ ì‹œ ì‘ê¸‰ ì¼€ì–´ ëª¨ë“œ (í˜¸í¡ ìœ ë„ ë“±)
- **Deep Conversation**: ê³ í†µì´ ë‚®ê³  ì§„ì§€í•¨ì´ ë†’ìœ¼ë©´ ì² í•™ì  ëŒ€í™” ëª¨ë“œ
- ë„êµ¬ ì‚¬ìš©:
  - `recommend_activities_tool`: í™œë™ ì¶”ì²œ (Micro-Activities í¬í•¨)
  - `search_empathy_questions_tool`: ê³µê° ì§ˆë¬¸ ê²€ìƒ‰
  - `search_welldying_wisdom_tool`: ì² í•™ì  ì§€í˜œ ê²€ìƒ‰
  - `search_realtime_info_tool`: ì‹¤ì‹œê°„ ì •ë³´ ê²€ìƒ‰ (Tavily)

**B. ì •ë³´ ì œê³µ ëª¨ë“œ (`info_agent`)**
- ìž¥ë¡€ ì‹œì„¤, ì§€ì› ì •ì±…, ìœ ì‚° ìƒì†, ë””ì§€í„¸ ì •ë³´ ì œê³µ
- **í˜„ìž¬ ë¯¸êµ¬í˜„ ìƒíƒœ** (Placeholder)

#### ëŒ€í™” íë¦„ (LangGraph)
```
ì‚¬ìš©ìž ë©”ì‹œì§€ ìž…ë ¥
    â†“
ëª¨ë“œ ë¼ìš°íŒ… (chat/info)
    â†“
empathy_agent (Context Analyzer ìž‘ë™)
    â†“
[ê³ í†µ/ì§„ì§€í•¨ íŒë‹¨] â†’ [ì‘ê¸‰/ì‹¬ì˜¤/ì¼ìƒ ëª¨ë“œ ë¶„ê¸°]
    â†“
ë„êµ¬ í˜¸ì¶œ í•„ìš” ì‹œ â†’ tools ë…¸ë“œ (Pain-Aware Logic ìž‘ë™)
    â†“
ì‘ë‹µ ìƒì„± ë° ì €ìž¥
```

### 2. ë‹¤ì´ì–´ë¦¬ ì‹œìŠ¤í…œ

- **ìžë™ ìƒì„±**: ì˜¤ëŠ˜ì˜ ëŒ€í™”ë¥¼ LLMìœ¼ë¡œ ìš”ì•½í•˜ì—¬ ë‹¤ì´ì–´ë¦¬ ìƒì„±
- **ìº˜ë¦°ë” UI**: ë‚ ì§œë³„ ë‹¤ì´ì–´ë¦¬ ì¡°íšŒ
- **ë©”íƒ€ë°ì´í„°**: ì´ëª¨ì§€, í‚¤ì›Œë“œ, ë¯¸ë¦¬ë³´ê¸°

### 3. ì›¹ UI

**íŽ˜ì´ì§€ êµ¬ì„±**:
- **í™ˆ**: ëžœë”© íŽ˜ì´ì§€
- **ì•Œë ¤ì¤˜ìš”**: ì •ë³´ ì„œë¹„ìŠ¤ ì¹´ë“œ (4ê°€ì§€)
- **ëŒ€í™”í•´ìš”**: ì±—ë´‡ ì¸í„°íŽ˜ì´ìŠ¤
- **ë‹¤ì´ì–´ë¦¬**: ìº˜ë¦°ë” ë° ë‹¤ì´ì–´ë¦¬ ì¡°íšŒ

---

## ðŸ“ ìˆ˜ì •ì´ í•„ìš”í•œ ë¶€ë¶„ ë° ìœ„ì¹˜

### ðŸ”´ ê¸´ê¸‰ ìˆ˜ì • ì‚¬í•­

#### 1. **Info Agent ë¯¸êµ¬í˜„** 
**ìœ„ì¹˜**: `chatbot/chatbot_modules/info_agent.py`
- í˜„ìž¬ ë‹¨ìˆœ í”Œë ˆì´ìŠ¤í™€ë”ë§Œ ìžˆìŒ
- ì •ë³´ ì œê³µ ë¡œì§ êµ¬í˜„ í•„ìš”
- RAG ë„êµ¬ ì—°ë™ í•„ìš” (ìž¥ë¡€ ì‹œì„¤, ì •ì±… ì •ë³´ ë“±)

#### 2. **í•˜ë“œì½”ë”©ëœ ì‚¬ìš©ìž ID**
**ìœ„ì¹˜**: `web/views.py` (50ì¤„)
```python
user_id = "test_user_01"  # í•˜ë“œì½”ë”©ë¨
```
- ì‹¤ì œ ì‚¬ìš©ìž ì¸ì¦ ì‹œìŠ¤í…œ ì—°ë™ í•„ìš”

### ðŸŸ¡ ê°œì„  ê¶Œìž¥ ì‚¬í•­

#### 3. **ë‹¤ì´ì–´ë¦¬ ìƒì„± íŠ¸ë¦¬ê±°**
**ìœ„ì¹˜**: `chatbot/conversation_engine.py` (115-116ì¤„)
- í˜„ìž¬ "ë‹¤ì´ì–´ë¦¬" í…ìŠ¤íŠ¸ ìž…ë ¥ìœ¼ë¡œë§Œ íŠ¸ë¦¬ê±°ë¨
- UI ë²„íŠ¼ê³¼ ì—°ë™ í•„ìš”

#### 4. **ì„¸ì…˜ ê´€ë¦¬ ê°œì„ **
**ìœ„ì¹˜**: `chatbot/chatbot_modules/session_manager.py`
- JSON íŒŒì¼ ê¸°ë°˜ ì €ìž¥ â†’ DB ë§ˆì´ê·¸ë ˆì´ì…˜ ê³ ë ¤
- ë™ì‹œì„± ë¬¸ì œ í•´ê²° í•„ìš”

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì™„ë£Œëœ í•­ëª© (2025.12.12)
- [x] **ê³ í†µ ê°ì§€ ë¡œì§ (Pain-Aware Logic)** êµ¬í˜„
- [x] **í†µí•© ë¶„ì„ê¸° (Context Analyzer)** êµ¬í˜„
- [x] **ì˜ë£Œì  íŒ©íŠ¸ ì²´í¬** í”„ë¡¬í”„íŠ¸ ì ìš©
- [x] **Ngrok ì—°ë™** ë° ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ìž‘ì„±
- [x] **DB ì—°ê²°** ë° ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸

### ë‚¨ì€ ê³¼ì œ
- [ ] Info Agent êµ¬í˜„
- [ ] ì‚¬ìš©ìž ì¸ì¦ ì‹œìŠ¤í…œ (Login/Signup)
- [ ] ë‹¤ì´ì–´ë¦¬ UI ì—°ë™

---

**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-12
**ìž‘ì„±ìž**: AI Assistant & KSU
**ë²„ì „**: 1.1
